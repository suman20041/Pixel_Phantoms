document.addEventListener("DOMContentLoaded",()=>{const contactForm=document.getElementById("contact-form");const feedbackMsg=document.getElementById("form-feedback");const submitBtn=document.querySelector(".btn-submit");const originalBtnText=submitBtn.innerHTML;const nameInput=document.getElementById("name");const emailInput=document.getElementById("email");const messageInput=document.getElementById("message");const charCount=document.getElementById("char-count");const charCounter=document.querySelector(".char-counter");const nameError=document.getElementById("name-error");const emailError=document.getElementById("email-error");const messageError=document.getElementById("message-error");const validationRules={name:{minLength:2,maxLength:50,pattern:/^[a-zA-Z\s'-]+$/,errorMessages:{required:"Name is required",minLength:"Name must be at least 2 characters",maxLength:"Name must be less than 50 characters",pattern:"Name can only contain letters, spaces, hyphens, and apostrophes"}},email:{pattern:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,errorMessages:{required:"Email is required",pattern:"Please enter a valid email address"}},message:{minLength:10,maxLength:500,errorMessages:{required:"Message is required",minLength:"Message must be at least 10 characters",maxLength:"Message must be less than 500 characters"}}};function sanitizeInput(input){return input.trim().replace(/[<>"'&]/g,char=>{const entityMap={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"};return entityMap[char]})}function showError(element,message){element.textContent=message;element.classList.add("show")}function hideError(element){element.classList.remove("show");setTimeout(()=>{element.textContent=""},300)}function validateField(input,rules,errorElement){const value=sanitizeInput(input.value);const fieldName=input.id;if(!value){showError(errorElement,rules.errorMessages.required);input.classList.remove("valid");input.classList.add("invalid");return false}if(rules.minLength&&value.length<rules.minLength){showError(errorElement,rules.errorMessages.minLength);input.classList.remove("valid");input.classList.add("invalid");return false}if(rules.maxLength&&value.length>rules.maxLength){showError(errorElement,rules.errorMessages.maxLength);input.classList.remove("valid");input.classList.add("invalid");return false}if(rules.pattern&&!rules.pattern.test(value)){showError(errorElement,rules.errorMessages.pattern);input.classList.remove("valid");input.classList.add("invalid");return false}hideError(errorElement);input.classList.remove("invalid");input.classList.add("valid");return true}function updateCharCounter(){const currentLength=messageInput.value.length;const maxLength=validationRules.message.maxLength;charCount.textContent=currentLength;charCounter.classList.remove("warning","error");if(currentLength>maxLength*.8){charCounter.classList.add("warning")}if(currentLength>=maxLength){charCounter.classList.add("error")}}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}const debouncedValidateName=debounce(()=>{validateField(nameInput,validationRules.name,nameError)},300);const debouncedValidateEmail=debounce(()=>{validateField(emailInput,validationRules.email,emailError)},300);const debouncedValidateMessage=debounce(()=>{validateField(messageInput,validationRules.message,messageError)},300);nameInput.addEventListener("input",debouncedValidateName);nameInput.addEventListener("blur",()=>validateField(nameInput,validationRules.name,nameError));emailInput.addEventListener("input",debouncedValidateEmail);emailInput.addEventListener("blur",()=>validateField(emailInput,validationRules.email,emailError));messageInput.addEventListener("input",()=>{updateCharCounter();debouncedValidateMessage()});messageInput.addEventListener("blur",()=>validateField(messageInput,validationRules.message,messageError));updateCharCounter();if(contactForm){const RATE_LIMIT_KEY='pp_contact_last_submit',RATE_LIMIT_SECONDS=5;let countdownInterval=null;function showFeedback(msg,type,animate){feedbackMsg.textContent=msg;feedbackMsg.className=('feedback-message '+(type||'')).trim();if(animate){feedbackMsg.classList.add(animate);setTimeout(()=>feedbackMsg.classList.remove(animate),600)}}function startCountdown(seconds){clearInterval(countdownInterval);let rem=seconds;showFeedback(`⚠️ Please wait ${rem} seconds before submitting again`,'error','animate-slide');countdownInterval=setInterval(()=>{rem-=1;if(rem<=0){clearInterval(countdownInterval);showFeedback('','');return}showFeedback(`⚠️ Please wait ${rem} seconds before submitting again`,'error','animate-slide')},1e3)}contactForm.addEventListener("submit",e=>{e.preventDefault();const hp=document.querySelector('input[data-honeypot="true"]');if(hp&&hp.value.trim()!==''){showFeedback('❌ Spam detected. Please try again.','error','animate-error');contactForm.classList.add('shake');setTimeout(()=>contactForm.classList.remove('shake'),600);return}const now=Date.now(),lastTs=Number(localStorage.getItem(RATE_LIMIT_KEY)||0),elapsed=Math.floor((now-lastTs)/1000);if(lastTs&&elapsed<RATE_LIMIT_SECONDS){startCountdown(RATE_LIMIT_SECONDS-elapsed);return}const isNameValid=validateField(nameInput,validationRules.name,nameError),isEmailValid=validateField(emailInput,validationRules.email,emailError),isMessageValid=validateField(messageInput,validationRules.message,messageError);if(!isNameValid||!isEmailValid||!isMessageValid){showFeedback('❌ All fields are required and must be valid.','error','animate-error');return}submitBtn.disabled=true;submitBtn.innerHTML='<i class="fas fa-spinner fa-spin spinner"></i> Sending...';submitBtn.classList.add('loading');setTimeout(()=>{try{const isSuccess=Math.random()>.1;if(isSuccess){showFeedback("✅ Message sent successfully! We'll get back to you soon.",'success','animate-success');contactForm.reset();updateCharCounter();[nameInput,emailInput,messageInput].forEach(i=>i.classList.remove('valid','invalid'));localStorage.setItem(RATE_LIMIT_KEY,String(Date.now()))}else throw new Error('Network error')}catch(e){showFeedback('❌ Failed to send message. Please try again later.','error','animate-error')}submitBtn.innerHTML=originalBtnText;submitBtn.disabled=false;submitBtn.classList.remove('loading')},1500)})}});